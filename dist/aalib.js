/*! For license information please see aalib.js.LICENSE.txt */
!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.aalib=r():t.aalib=r()}(self,(()=>(()=>{"use strict";var t={707:(t,r,e)=>{var n=e(901),o=e(518),i=e(404),u=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,i=o.toSubscriber(t,r,e);if(n?n.call(i,this.source):i.add(this.source?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.syncErrorThrown=!0,t.syncErrorValue=r,t.error(r)}},t.prototype.forEach=function(t,r){var e=this;if(r||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?r=n.root.Rx.config.Promise:n.root.Promise&&(r=n.root.Promise)),!r)throw new Error("no Promise impl found");return new r((function(r,n){var o;o=e.subscribe((function(r){if(o)try{t(r)}catch(t){n(t),o.unsubscribe()}else t(r)}),n,r)}))},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[i.observable]=function(){return this},t.create=function(r){return new t(r)},t}();r.Observable=u},432:(t,r)=>{r.empty={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},308:function(t,r,e){var n=this&&this.__extends||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=e(497),i=e(303),u=e(432),c=e(429),a=function(t){function r(e,n,o){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=u.empty;break;case 1:if(!e){this.destination=u.empty;break}if("object"==typeof e){e instanceof r?(this.destination=e,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new s(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new s(this,e,n,o)}}return n(r,t),r.prototype[c.rxSubscriber]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parent,r=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=r,this},r}(i.Subscription);r.Subscriber=a;var s=function(t){function r(r,e,n,i){var c;t.call(this),this._parentSubscriber=r;var a=this;o.isFunction(e)?c=e:e&&(c=e.next,n=e.error,i=e.complete,e!==u.empty&&(a=Object.create(e),o.isFunction(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=c,this._error=n,this._complete=i}return n(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber;if(this._error)r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!r.syncErrorThrowable)throw this.unsubscribe(),t;r.syncErrorValue=t,r.syncErrorThrown=!0,this.unsubscribe()}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){throw this.unsubscribe(),t}},r.prototype.__tryOrSetError=function(t,r,e){try{r.call(this._context,e)}catch(r){return t.syncErrorValue=r,t.syncErrorThrown=!0,!0}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(a)},303:(t,r,e)=>{var n=e(208),o=e(690),i=e(497),u=e(181),c=e(36),a=e(229),s=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var r;return t.prototype.unsubscribe=function(){var t,r=!1;if(!this.closed){var e=this,s=e._parent,l=e._parents,p=e._unsubscribe,h=e._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var b=-1,y=l?l.length:0;s;)s.remove(this),s=++b<y&&l[b]||null;if(i.isFunction(p))u.tryCatch(p).call(this)===c.errorObject&&(r=!0,t=t||(c.errorObject.e instanceof a.UnsubscriptionError?f(c.errorObject.e.errors):[c.errorObject.e]));if(n.isArray(h))for(b=-1,y=h.length;++b<y;){var d=h[b];if(o.isObject(d))if(u.tryCatch(d.unsubscribe).call(d)===c.errorObject){r=!0,t=t||[];var v=c.errorObject.e;v instanceof a.UnsubscriptionError?t=t.concat(f(v.errors)):t.push(v)}}if(r)throw new a.UnsubscriptionError(t)}},t.prototype.add=function(r){if(!r||r===t.EMPTY)return t.EMPTY;if(r===this)return this;var e=r;switch(typeof r){case"function":e=new t(r);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if("function"!=typeof e._addParent){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(e),e._addParent(this),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.prototype._addParent=function(t){var r=this._parent,e=this._parents;r&&r!==t?e?-1===e.indexOf(t)&&e.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((r=new t).closed=!0,r),t}();function f(t){return t.reduce((function(t,r){return t.concat(r instanceof a.UnsubscriptionError?r.errors:r)}),[])}r.Subscription=s},576:(t,r,e)=>{var n=e(707),o=e(28);n.Observable.prototype.do=o._do,n.Observable.prototype._do=o._do},359:(t,r,e)=>{var n=e(707),o=e(947);n.Observable.prototype.map=o.map},28:function(t,r,e){var n=this&&this.__extends||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=e(308);r._do=function(t,r,e){return this.lift(new i(t,r,e))};var i=function(){function t(t,r,e){this.nextOrObserver=t,this.error=r,this.complete=e}return t.prototype.call=function(t,r){return r.subscribe(new u(t,this.nextOrObserver,this.error,this.complete))},t}(),u=function(t){function r(r,e,n,i){t.call(this,r);var u=new o.Subscriber(e,n,i);u.syncErrorThrowable=!0,this.add(u),this.safeSubscriber=u}return n(r,t),r.prototype._next=function(t){var r=this.safeSubscriber;r.next(t),r.syncErrorThrown?this.destination.error(r.syncErrorValue):this.destination.next(t)},r.prototype._error=function(t){var r=this.safeSubscriber;r.error(t),r.syncErrorThrown?this.destination.error(r.syncErrorValue):this.destination.error(t)},r.prototype._complete=function(){var t=this.safeSubscriber;t.complete(),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.complete()},r}(o.Subscriber)},947:function(t,r,e){var n=this&&this.__extends||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=e(308);r.map=function(t,r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return this.lift(new i(t,r))};var i=function(){function t(t,r){this.project=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new u(t,this.project,this.thisArg))},t}();r.MapOperator=i;var u=function(t){function r(r,e,n){t.call(this,r),this.project=e,this.count=0,this.thisArg=n||this}return n(r,t),r.prototype._next=function(t){var r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(r)},r}(o.Subscriber)},404:(t,r,e)=>{var n=e(901);function o(t){var r,e=t.Symbol;return"function"==typeof e?e.observable?r=e.observable:(r=e("observable"),e.observable=r):r="@@observable",r}r.getSymbolObservable=o,r.observable=o(n.root),r.$$observable=r.observable},429:(t,r,e)=>{var n=e(901).root.Symbol;r.rxSubscriber="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber",r.$$rxSubscriber=r.rxSubscriber},229:function(t,r){var e=this&&this.__extends||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},n=function(t){function r(r){t.call(this),this.errors=r;var e=Error.call(this,r?r.length+" errors occurred during unsubscription:\n  "+r.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"");this.name=e.name="UnsubscriptionError",this.stack=e.stack,this.message=e.message}return e(r,t),r}(Error);r.UnsubscriptionError=n},36:(t,r)=>{r.errorObject={e:{}}},208:(t,r)=>{r.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},497:(t,r)=>{r.isFunction=function(t){return"function"==typeof t}},690:(t,r)=>{r.isObject=function(t){return null!=t&&"object"==typeof t}},901:(t,r,e)=>{var n="undefined"!=typeof window&&window,o="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i=void 0!==e.g&&e.g,u=n||i||o;r.root=u,function(){if(!u)throw new Error("RxJS could not find any global context (window, self, global)")}()},518:(t,r,e)=>{var n=e(308),o=e(429),i=e(432);r.toSubscriber=function(t,r,e){if(t){if(t instanceof n.Subscriber)return t;if(t[o.rxSubscriber])return t[o.rxSubscriber]()}return t||r||e?new n.Subscriber(t,r,e):new n.Subscriber(i.empty)}},181:(t,r,e)=>{var n,o=e(36);function i(){try{return n.apply(this,arguments)}catch(t){return o.errorObject.e=t,o.errorObject}}r.tryCatch=function(t){return n=t,i}}},r={};function e(n){var o=r[n];if(void 0!==o)return o.exports;var i=r[n]={exports:{}};return t[n].call(i.exports,i,i.exports,e),i.exports}e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};e.r(n),e.d(n,{aa:()=>gt,charset:()=>jt,default:()=>Et,filter:()=>St,read:()=>_t,render:()=>Ot});var o=e(707);e(359),e(576);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function u(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function c(t){var r=function(t,r){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==i(r)?r:r+""}var a=function(){return t=function t(){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t)},(r=[{key:"read",value:function(){var t=this;return o.Observable.create((function(r){return t.onRead(r),t.onDispose.bind(t)}))}},{key:"onRead",value:function(){}},{key:"onDispose",value:function(){}}])&&u(t.prototype,r),e&&u(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,e}();function s(t,r,e,n,o){return n+(o-n)/(e-r)*(t-r)}function f(t){return t>255?255:t<0?0:t}const l={mul:function(t,r){return t.r=~~(t.r*r),t.g=~~(t.g*r),t.b=~~(t.b*r),this},add:function(t,r){return t.r+=r,t.g+=r,t.b+=r,this},addc:function(t,r){var e=r.r,n=r.g,o=r.b;return t.r+=e,t.g+=n,t.b+=o,this},div:function(t,r){return this.mul(t,1/r)},inverse:function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this},getGrayscale:function(t){return~~((t.r+t.g+t.b)/3)},desaturate:function(t){return t.r=t.g=t.b=this.getGrayscale(t),this},clamp:function(t){return t.r=f(t.r),t.g=f(t.g),t.b=f(t.b),this}};function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function h(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function b(t){var r=function(t,r){if("object"!=p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==p(r)?r:r+""}var y=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.width,n=r.height,o=r.colorProcessor,i=r.data,u=void 0===i?[]:i,c=r.meta,a=void 0===c?{}:c;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=e,this.height=n,this.data=u,this.meta=a,this.colorProcessor=o}return r=t,n=[{key:"fromImageData",value:function(r){for(var e,n=new Uint32Array(r.data.buffer),o=n.length,i=new Array(o),u=o;u--;)e=n[u],i[u]={r:255&e,g:e>>8&255,b:e>>16&255};return new t({data:i,width:r.width,height:r.height,colorProcessor:l})}},{key:"fromHTMLImageElement",value:function(r){var e=document.createElement("canvas"),n=e.getContext("2d"),o=r.naturalWidth,i=r.naturalHeight;return e.width=o,e.height=i,n.drawImage(r,0,0),t.fromImageData(n.getImageData(0,0,o,i))}}],(e=[{key:"getAt",value:function(t,r){return this.data[t+this.width*r]}},{key:"process",value:function(t){var r=this;return this.data.forEach((function(e){t(e,r.colorProcessor)})),this}},{key:"toImageData",value:function(){for(var t,r=[],e=0;e<this.data.length;e++)t=this.data[e],r[r.length]=t.r,r[r.length]=t.g,r[r.length]=t.b,r[r.length]=255;return new ImageData(new Uint8ClampedArray(r),this.width,this.height)}}])&&h(r.prototype,e),n&&h(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,e,n}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function v(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function m(t){var r=function(t,r){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==d(r)?r:r+""}function g(t,r,e){return r=_(r),function(t,r){if(r&&("object"==d(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,w()?Reflect.construct(r,e||[],_(t).constructor):r.apply(t,e))}function w(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(w=function(){return!!t})()}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}function S(t,r){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},S(t,r)}var O=function(t){function r(t){var e;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),(e=g(this,r)).url=t,e}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&S(t,r)}(r,t),e=r,n=[{key:"onRead",value:function(t){var r=document.createElement("img");r.crossOrigin="Anonymous";var e=function(){o(),t.next(y.fromHTMLImageElement(r)),t.complete()},n=function(r){o(),t.error(r)},o=function(){r.removeEventListener("load",e),r.removeEventListener("error",n)};r.addEventListener("load",e),r.addEventListener("error",n),r.complete&&r.naturalWidth?e():this.url&&(r.src=this.url)}}],o=[{key:"fromURL",value:function(t){return new r(t).read()}},{key:"fromHTMLImage",value:function(t){return r.fromURL(t.src)}}],n&&v(e.prototype,n),o&&v(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}(a);function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function E(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,P(n.key),n)}}function P(t){var r=function(t,r){if("object"!=j(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==j(r)?r:r+""}function x(t,r,e){return r=k(r),function(t,r){if(r&&("object"==j(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,T()?Reflect.construct(r,e||[],k(t).constructor):r.apply(t,e))}function T(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(T=function(){return!!t})()}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function R(t,r){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},R(t,r)}var C=function(t){function r(t,e,n){var o;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),(o=x(this,r)).video=t,o.options=Object.assign({},{autoplay:!1},n),o.video.autoplay=o.options.autoplay,o.captureFrame=e,o}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&R(t,r)}(r,t),e=r,n=[{key:"createVideoElement",value:function(t){var r=document.createElement("video");return r.src=t,r.crossOrigin="anonymous",r.controls=!0,document.body.appendChild(r),r}},{key:"onRead",value:function(t){var r=this,e=this.video;this.playbackLoop=function(){e.paused||e.ended||(t.next(y.fromImageData(r.captureFrame(e))),requestAnimationFrame(r.playbackLoop))},this.onError=function(){var n=e.src,o=e.error,i=o.code,u=o.message;e.removeEventListener("play",r.playbackLoop),t.error("Error occurred while trying to play ".concat(n,": ").concat(i,", ").concat(u))},e.addEventListener("error",this.onError),e.addEventListener("play",this.playbackLoop),this.options.autoplay&&e.play()}},{key:"onDispose",value:function(){this.video.removeEventListener("play",this.playbackLoop),this.video.removeEventListener("error",this.onError),this.video.parentNode&&this.video.parentNode.removeChild(this.video)}}],o=[{key:"fromVideoElement",value:function(t,e){return console.log("read from video element"),new r(t,A(),e).read()}},{key:"fromURL",value:function(t,e){return console.log("read from url ".concat(t)),new r(t,A(),e).read()}}],n&&E(e.prototype,n),o&&E(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}(a);function A(){var t=document.createElement("canvas"),r=t.getContext("2d");return function(e){var n=e.videoWidth,o=e.videoHeight;return t.width=n,t.height=o,r.drawImage(e,0,0,n,o),r.getImageData(0,0,n,o)}}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function L(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,D(n.key),n)}}function D(t){var r=function(t,r){if("object"!=I(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==I(r)?r:r+""}function F(t,r,e){return r=M(r),function(t,r){if(r&&("object"==I(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,U()?Reflect.construct(r,e||[],M(t).constructor):r.apply(t,e))}function U(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(U=function(){return!!t})()}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}function N(t,r){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},N(t,r)}var V=function(t){function r(t){var e;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),(e=F(this,r)).idata=t,e}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&N(t,r)}(r,t),e=r,o=[{key:"fromImageData",value:function(t){return new r(t).read()}},{key:"fromCanvas",value:function(t,e,n,o,i){var u=t.getContext("2d").getImageData(e||0,n||0,o||t.width,i||t.height);return r.fromImageData(u)}}],(n=[{key:"onRead",value:function(t){t.next(y.fromImageData(this.idata)),t.complete()}}])&&L(e.prototype,n),o&&L(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}(a);function B(t,r){return function(e){return H(e,t,r)}}function H(t,r,e){return t.process((function(t,n){n.mul(t,r).add(t,e).clamp(t)}))}function G(t,r){for(var e,n=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=r.fontFamily,n=void 0===e?"monospace":e,o=z(),i=o.canvas,u=o.ctx;return u.fillStyle="#fff",u.fillRect(0,0,i.width,i.height),u.fillStyle="#000",u.textBaseline="top",u.textAlign="left",u.font="20px "+n,u.fillText(t,0,0),i}(t,r),o=n.getContext("2d").getImageData(0,0,n.width,n.height),i=new Uint32Array(o.data.buffer),u=0,c=i.length;c--;)u+=((255&(e=i[c]))+(e>>8&255)+(e>>16&255))/3;return u/=n.width*n.height}var W,z=((W=function(){var t=document.createElement("canvas"),r=t.getContext("2d",{alpha:!1});return t.width=15,t.height=25,{canvas:t,ctx:r}})._result=null,function(){return W._result||(W._result=W())});function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function Y(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,q(n.key),n)}}function q(t){var r=function(t,r){if("object"!=$(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==$(r)?r:r+""}var J,K,Q=function(){return t=function t(r){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({},{charset:X,fontFamily:"monospace"},r),this.fontmap=t.buildFont(this.options.charset,{fontFamily:this.options.fontFamily}),this.matchChar=function(t){return t._cache=[],function(r){return t._cache[r]||(t._cache[r]=t(r))}}(this.matchChar.bind(this))},e=[{key:"buildFont",value:function(t,r){return function(t,r){for(var e=new Array(t.length),n=255,o=0,i=0;i<t.length;i++){var u=t[i],c=G(u,r);c<n&&(n=c),c>o&&(o=c),e[i]={char:u,brightness:c}}return e.map((function(t){return{char:t.char,brightness:~~s(t.brightness,n,o,0,255)}})).sort((function(t,r){return t.brightness<r.brightness?-1:t.brightness>r.brightness?1:0}))}(t,r)}}],(r=[{key:"render",value:function(t){return this.processImage(t)}},{key:"processImage",value:function(t){for(var r,e=t.data.length;e--;)(r=t.data[e]).char=this.matchChar(r.mono);return t}},{key:"matchChar",value:function(t){for(var r={brightness:-1},e=0;e<this.fontmap.length;e++){var n=this.fontmap[e];if(!(Math.abs(t-n.brightness)<=Math.abs(t-r.brightness)))return r.char;r=n}return r.char}}])&&Y(t.prototype,r),e&&Y(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,e}(),X=(J=32,K=126,Array.from(new Array(K-J+1).keys()).map((function(t){return t+J}))).map((function(t){return String.fromCharCode(t)}));function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function tt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function rt(t){var r=function(t,r){if("object"!=Z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==Z(r)?r:r+""}function et(t,r,e){return r=it(r),function(t,r){if(r&&("object"==Z(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,nt()?Reflect.construct(r,e||[],it(t).constructor):r.apply(t,e))}function nt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(nt=function(){return!!t})()}function ot(){return ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,r,e){var n=function(t,r){for(;!{}.hasOwnProperty.call(t,r)&&null!==(t=it(t)););return t}(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(arguments.length<3?t:e):o.value}},ot.apply(null,arguments)}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},it(t)}function ut(t,r){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},ut(t,r)}var ct=function(t){function r(t){var e;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),(e=et(this,r,[Object.assign({},{tagName:"pre",fontSize:7,background:"#fff",color:"#000"},t)])).el=e.options.el||document.createElement(e.options.tagName),e.el.style.fontSize=e.options.fontSize+"px",e.el.style.fontFamily=e.options.fontFamily,e.el.style.backgroundColor=e.options.background,e.el.style.color=e.options.color,e}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&ut(t,r)}(r,t),e=r,(n=[{key:"render",value:function(t){ot(it(r.prototype),"render",this).call(this,t);var e,n,o=(e=this.el,n=at((function(t){return t.char})),function(t){return e.textContent=n(t),e});return o(t)}},{key:"createGradient",value:function(){var t=this,r=this.options.gradient.map((function(r,e){return"".concat(r," ").concat(e/(t.options.gradient.length-1)*100,"%")})).join(", ");this.gradient=r,console.log("color in create gradient is ",r)}}])&&tt(e.prototype,n),o&&tt(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}(Q);function at(t){return function(r){for(var e=r.width,n=r.data,o="",i=e,u=0,c=n.length;u<c;u++,i--)0===i&&(o+="\n",i=e),o+=t(n[u]);return o}}function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function ft(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,lt(n.key),n)}}function lt(t){var r=function(t,r){if("object"!=st(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=st(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==st(r)?r:r+""}function pt(t,r,e){return r=yt(r),function(t,r){if(r&&("object"==st(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ht()?Reflect.construct(r,e||[],yt(t).constructor):r.apply(t,e))}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ht=function(){return!!t})()}function bt(){return bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,r,e){var n=function(t,r){for(;!{}.hasOwnProperty.call(t,r)&&null!==(t=yt(t)););return t}(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(arguments.length<3?t:e):o.value}},bt.apply(null,arguments)}function yt(t){return yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yt(t)}function dt(t,r){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},dt(t,r)}var vt=function(t){function r(t){var e;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),(e=pt(this,r,[Object.assign({},{fontSize:7,lineHeight:7,charWidth:4.2,width:400,height:300,background:"#fff",color:"#000",gradient:null},t)])).el=e.options.el||document.createElement("canvas"),e.el.width=e.options.width,e.el.height=e.options.height,e.ctx=e.el.getContext("2d"),e.ctx.textBaseline="top",e.ctx.textAlign="start",e.ctx.font=e.options.fontSize+"px "+e.options.fontFamily,e.options.gradient?e.createGradientStop():e.el.style.backgroundColor=e.options.background,e}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dt(t,r)}(r,t),e=r,(n=[{key:"createGradient",value:function(){var t=this,r=this.ctx.createLinearGradient(0,0,this.el.width,this.el.height);this.options.gradient.forEach((function(e,n){r.addColorStop(e/(t.options.gradient.length-1),n)})),this.gradient=r}},{key:"createGradientStop",value:function(){var t=this.ctx.createLinearGradient(0,0,this.el.width,this.el.height);this.options.gradient.forEach((function(r,e){t.addColorStop(r,e)})),this.gradient=t}},{key:"render",value:function(t){var e,n;return bt(yt(r.prototype),"render",this).call(this,t),this.clearCanvas(),(t.meta.colored?(e=this.ctx,n=this.options,function(t){for(var r,o,i,u=t.data,c=t.width,a=n.charWidth,s=n.lineHeight,f=u.length;f--;)r=f%c,o=~~(f/c),i=u[f],e.fillStyle="rgb(".concat(i.r,", ").concat(i.g,", ").concat(i.b,")"),e.fillText(u[f].char,r*a,o*s)}):function(t,r){return function(e){var n,o=e.data,i=e.width,u=r.lineHeight,c="";t.fillStyle=r.color;for(var a=0,s=o.length;a<s;a+=i){n=~~(a/i),c="";for(var f=a;f<a+i;f++)c+=o[f].char;t.fillText(c,0,n*u)}}}(this.ctx,this.options))(t),this.el}},{key:"clearCanvas",value:function(){this.gradient?this.ctx.fillStyle=this.gradient:this.ctx.fillStyle=this.options.background,this.ctx.fillRect(0,0,this.el.width,this.el.height)}}])&&ft(e.prototype,n),o&&ft(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}(Q);const mt={mul:function(t,r){return t.mono=~~(t.mono*r),this},add:function(t,r){return t.mono+=r,this},div:function(t,r){this.mul(t,1/r)},inverse:function(t){return t.mono=255-t.mono,this},desaturate:function(t){return t.r=t.g=t.b=t.mono,t},clamp:function(t){return t.mono=f(t.mono),this}};function gt(t){return function(r){return function(t,r){for(var e=r.width,n=r.height,o=r.colored,i=void 0!==o&&o,u=t.width/e,c=t.height/n,a=255,f=0,l=new Array(e*n),p=0,h=0;h<n;h++)for(var b=0;b<e;b++){var d=wt(t,~~(b*u),~~(h*c),u,c);d.mono>f&&(f=d.mono),d.mono<a&&(a=d.mono),l[p++]=d}var v=new y({width:e,height:n,data:l,colorProcessor:mt,meta:{colored:i}});return function(t,r,e){t.process((function(t){t.mono=~~s(t.mono,r,e,0,255)}))}(v,a,f),v}(r,t)}}function wt(t,r,e,n,o){for(var i={r:0,g:0,b:0},u=0,c=0;c<o;c++)for(var a=0;a<n;a++)l.addc(i,t.getAt(r+a,e+c)),u++;return l.div(i,u),{r:i.r,g:i.g,b:i.b,mono:l.getGrayscale(i)}}var _t={image:{fromHTMLImage:O.fromHTMLImage,fromURL:O.fromURL},imageData:{fromImageData:V.fromImageData,fromCanvas:V.fromCanvas},video:{fromVideoElement:C.fromVideoElement}},St={linear:B,brightness:function(t){return function(r){return function(t,r){return B(1,r||0)(t)}(r,t)}},contrast:function(t){return function(r){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return H(t,r,0)}(r,t)}},inverse:function(){return function(t){return function(t){return t.process((function(t,r){r.inverse(t).clamp(t)}))}(t)}},desaturate:function(){return function(t){return function(t){return t.process((function(t,r){r.desaturate(t)}))}(t)}}},Ot={html:function(t){var r=new ct(t);return function(t){return r.render(t)}},canvas:function(t){var r=new vt(t);return function(t){return r.render(t)}}},jt={SIMPLE_CHARSET:[".",":","*","I","$","V","F","N","M"],ASCII_CHARSET:X};const Et={aa:gt,read:_t,filter:St,render:Ot,charset:jt};return n})()));
//# sourceMappingURL=aalib.js.map